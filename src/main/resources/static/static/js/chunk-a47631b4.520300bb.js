(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a47631b4"],{"24b4":function(t,e,a){"use strict";a.d(e,"e",(function(){return n})),a.d(e,"g",(function(){return i})),a.d(e,"h",(function(){return r})),a.d(e,"b",(function(){return o})),a.d(e,"c",(function(){return c})),a.d(e,"d",(function(){return u})),a.d(e,"j",(function(){return l})),a.d(e,"f",(function(){return p})),a.d(e,"i",(function(){return d})),a.d(e,"a",(function(){return v}));var s=a("b775");function n(t){return Object(s["a"])({url:"/admin/gather/type",method:"get",params:t})}function i(t){return Object(s["a"])({url:"/admin/gather/main",method:"get",params:t})}function r(t){return Object(s["a"])({url:"/admin/gather/stop",method:"post",data:t})}function o(t){return Object(s["a"])({url:"/admin/sureying/log",method:"get",params:t})}function c(t){return Object(s["a"])({url:"/admin/sureying/log/single/segment",method:"get",params:t})}function u(t){return Object(s["a"])({url:"/admin/gather/log/status",method:"get",params:t})}function l(){return Object(s["a"])({url:"/admin/area/all",method:"get"})}function p(t){return Object(s["a"])({url:"/admin/unit/subnet/list",method:"post",data:t})}function d(t){return Object(s["a"])({url:"/admin/unit/subnet/batch",method:"post",data:t})}function v(t){return Object(s["a"])({url:"/admin/unit/subnet",method:"DELETE",params:t})}},"3bb4":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-card",{scopedSlots:t._u([{key:"header",fn:function(){return[a("div",{staticClass:"clearfix"},[a("span",{staticStyle:{"line-height":"28px"}},[t._v("测绘日志")]),a("div",{staticClass:"fr"},[a("el-button",{attrs:{size:"small",type:"primary",disabled:t.isRunning},on:{click:t.handBtn}},[t.isRunning?a("span",[a("i",{staticClass:"el-icon-loading"}),t._v(" 测绘中...")]):a("span",[t._v("开始测绘")])]),a("el-button",{attrs:{size:"small",type:"info",plain:""},on:{click:function(e){t.unitIpDialogFlag=!0}}},[t._v(" 网段划分 ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.rowDetail.result,expression:"rowDetail.result"}],attrs:{size:"small",type:"success"},on:{click:function(e){t.viewDialogFlag=!0}}},[t._v("测绘结果")])],1)])]},proxy:!0}])},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.startLoading,expression:"startLoading"}],staticClass:"logWrap fz12"},[t._l(t.logList,(function(e){return[a("div",{key:e.id,staticClass:"logItem"},[a("div",{staticClass:"flexBox"},[4==e.type?[a("div",{staticClass:"logContent"},[a("div",{staticClass:"logMsg"},[a("div",[t._v(t._s(e.name))])])])]:a("div",{staticClass:"logContent"},[a("div",{staticClass:"logMsg"},[a("p",[t._v(t._s(e.name))]),a("div",{staticClass:"time"},[a("span",[t._v(t._s(e.beginTime))]),t._v(" ~ "),a("span",[a("span",{directives:[{name:"show",rawName:"v-show",value:1===e.status,expression:"item.status === 1"}],staticClass:"successC"},[a("i",{staticClass:"el-icon-loading"}),a("span",{staticClass:"fz12"},[t._v(t._s("数据上传"===e.name?"数据上传中...":"分析中..."))])]),t._v(" "+t._s(e.endTime)+" ")])])]),a("div",{directives:[{name:"show",rawName:"v-show",value:2===e.status,expression:"item.status === 2"}],staticClass:"dot green"},[t._v("已完成")]),a("div",{directives:[{name:"show",rawName:"v-show",value:3===e.status,expression:"item.status === 3"}],staticClass:"dot red"},[t._v("失败")])]),a("div",{staticClass:"actions"})],2),e.subLogs?a("div",{staticClass:"subLogWrap p-l-10"},t._l(e.subLogs,(function(e){return a("div",{key:e.id,staticClass:"logContent"},[a("div",{staticClass:"logMsg"},[a("p",{staticStyle:{color:"#7b7b7bbf","text-align":"center"}},[t._v(t._s(e.name))]),a("div",{staticClass:"time"},[a("span",[t._v(t._s(e.beginTime))]),t._v(" ~ "),a("span",[a("span",{directives:[{name:"show",rawName:"v-show",value:1===e.status,expression:"subItem.status === 1"}],staticClass:"successC"},[a("i",{staticClass:"el-icon-loading"}),a("span",{staticClass:"fz12"},[t._v(t._s("数据上传"===e.name?"数据上传中...":"分析中..."))])]),t._v(" "+t._s(e.endTime)+" ")])])]),a("div",{directives:[{name:"show",rawName:"v-show",value:2===e.status,expression:"subItem.status === 2"}],staticClass:"dot green"},[t._v("已完成")]),a("div",{directives:[{name:"show",rawName:"v-show",value:3===e.status,expression:"subItem.status === 3"}],staticClass:"dot red"},[t._v("失败")])])})),0):t._e()])]})),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.isRunning&&t.logList.length,expression:"!isRunning && logList.length"}],staticClass:"logItem flexBox"},[a("div",{staticClass:"logContent"},[a("div",{staticClass:"logMsg"},[a("p",[t._v("测绘完成")])])])])],2),a("el-dialog",{attrs:{"close-on-click-modal":!1,title:"测绘完成","custom-class":"mw600 smTank",visible:t.viewDialogFlag,width:"80%",top:"20%"},on:{"update:visible":function(e){t.viewDialogFlag=e},open:t.getAsyncList}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.detailIsLoading,expression:"detailIsLoading"}]},[a("fieldset",{staticClass:"m-b-10"},[a("el-descriptions",{staticClass:"fz12",attrs:{column:1}},[a("el-descriptions-item",{attrs:{label:"IPv4终端"}},[t._v(t._s(t.rowDetail.ipv4))]),a("el-descriptions-item",{attrs:{label:"IPv4/IPv6终端"}},[t._v(t._s(t.rowDetail.ipv4_ipv6))])],1)],1),a("p",{staticClass:"infoC fz12"},[t._v("测绘结果文件 C:\\output\\目录")])])]),a("el-dialog",{attrs:{"close-on-click-modal":!1,title:"单位网段配置","custom-class":"smTank",visible:t.unitIpDialogFlag,width:"60%",top:"10%"},on:{"update:visible":function(e){t.unitIpDialogFlag=e},open:t.onUnitIpConfigOpen}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.detailIsLoading,expression:"detailIsLoading"}]},[a("div",{staticClass:"tipsRow m-b-10"},[t._v("注意：该功能仅为政务外网接入单位划分网段使用")]),a("div",{staticClass:"flexBox p-t-10 p-b-10"},[a("el-row",{staticClass:"flex1"},[a("el-col",{attrs:{span:10}},[a("div",{staticStyle:{color:"#666","font-weight":"bold"}},[t._v("单位名称")])]),a("el-col",{attrs:{span:7}},[a("div",{staticStyle:{color:"#666","font-weight":"bold","text-indent":"12px"}},[t._v("Ipv4网段")])]),a("el-col",{attrs:{span:7}},[a("div",{staticStyle:{color:"#666","font-weight":"bold","text-indent":"12px"}},[t._v("Ipv6网段")])])],1),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",type:"primary",plain:"",icon:"el-icon-plus"},on:{click:t.addUnitIpBtn}})],1),a("div",{attrs:{id:"unitIpListWrap"}},t._l(t.unitIpFormArr,(function(e,s){return a("el-form",{key:s,ref:"formItem"+s,refInFor:!0,staticClass:"unitForm",attrs:{rules:t.unitIpFormRules,model:e,"label-position":"top",size:"mini"}},[a("div",{staticClass:"flexBox item"},[a("el-row",{staticClass:"flex1",attrs:{gutter:20}},[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{prop:"unitId"}},[a("el-cascader",{staticStyle:{width:"100%"},attrs:{placeholder:"选择单位/可输入单位名称检索",options:t.unitSelectArr,props:{label:"name",value:"id",children:"subAreas",emitPath:!1},filterable:""},model:{value:e.unitId,callback:function(a){t.$set(e,"unitId",a)},expression:"formItem.unitId"}})],1)],1),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{prop:"ipv4Subnet"}},[a("el-input",{attrs:{placeholder:"例: 192.168.1.0/24 (多个网段用,分割)"},model:{value:e.ipv4Subnet,callback:function(a){t.$set(e,"ipv4Subnet","string"===typeof a?a.trim():a)},expression:"formItem.ipv4Subnet"}})],1)],1),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{prop:"ipv6Subnet"}},[a("el-input",{attrs:{placeholder:"例: 2001:db8::/32 (多个网段用,分割)"},model:{value:e.ipv6Subnet,callback:function(a){t.$set(e,"ipv6Subnet","string"===typeof a?a.trim():a)},expression:"formItem.ipv6Subnet"}})],1)],1)],1),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"mini",type:"info",plain:"",icon:"el-icon-close"},on:{click:function(a){return t.delUnitIpBtn(e,s)}}})],1)])})),1),a("div",{staticClass:"flexCC"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.saveUnitIpBtn}},[t._v(" 保 存 ")])],1)])])],1)},n=[],i=a("c7eb"),r=a("1da1"),o=(a("d3b7"),a("159b"),a("a434"),a("24b4")),c=a("ae6f"),u={data:function(){return{viewTablePost:{currentPage:1,pageSize:15},isRunning:!1,startLoading:!1,logTimer:null,logList:[],viewDialogFlag:!1,detailIsLoading:!1,rowDetail:{result:"",ipv4:"",ipv4_ipv6:"",subme_ipv4:[],subme_ipv6:[],gatewayInfo:[]},unitIpDialogFlag:!1,unitSelectArr:[],unitIpFormArr:[],unitIpFormRules:{unitId:[{required:!0,message:"请选择单位",trigger:"blur"}],ipv4Subnet:[{required:!0,message:"请输入Ipv4网段",trigger:"blur"}],ipv6Subnet:[{required:!0,message:"请输入Ipv6网段",trigger:"blur"}]}}},mounted:function(){this.getCaiJiStatus(),this.getAsyncList()},methods:{getCaiJiStatus:function(){var t=this;return Object(r["a"])(Object(i["a"])().mark((function e(){var a,s;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(o["g"])({type:1});case 2:if(a=e.sent,1002!==a.code){e.next=8;break}t.isRunning=!0,t.getLogList(),e.next=13;break;case 8:return e.next=10,Object(o["b"])();case 10:s=e.sent,200==s.code&&s.data&&(t.logList=s.data.data),t.isRunning=!1;case 13:case"end":return e.stop()}}),e)})))()},stopBtn:function(){var t=this;return Object(r["a"])(Object(i["a"])().mark((function e(){var a;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(o["h"])();case 2:a=e.sent,200===a.code?(t.logTimer&&clearTimeout(t.logTimer),t.getCaiJiStatus(),t.$message.success("停止成功")):t.$message.error(a.msg);case 4:case"end":return e.stop()}}),e)})))()},handBtn:function(){var t=this;return Object(r["a"])(Object(i["a"])().mark((function e(){return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.isRunning){e.next=2;break}return e.abrupt("return",t.$message({message:"正在采集中... 请勿重复提交",type:"warning"}));case 2:Object(o["g"])(),setTimeout((function(){t.getCaiJiStatus()}),500);case 4:case"end":return e.stop()}}),e)})))()},getLogList:function(){var t=this;return Object(r["a"])(Object(i["a"])().mark((function e(){var a;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(o["b"])();case 2:if(a=e.sent,200!=a.code||!a.data){e.next=13;break}if(t.logList=a.data.data,!a.data.finish){e.next=10;break}return t.isRunning=!1,e.abrupt("return");case 10:t.isRunning=!0,t.logTimer&&clearTimeout(t.logTimer),t.logTimer=setTimeout((function(){t.getLogList()}),2e3);case 13:t.startLoading=!1;case 14:case"end":return e.stop()}}),e)})))()},getAsyncList:function(){var t=this;return Object(r["a"])(Object(i["a"])().mark((function e(){var a,s,n;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.detailIsLoading=!0,e.next=3,Object(c["a"])(t.viewTablePost);case 3:a=e.sent,200==a.code&&a.data&&(s=a.data.obj[0]||{},n=s.details&&"string"===typeof s.details?JSON.parse(s.details):{},t.rowDetail.result=s.result,t.rowDetail.ipv4=n.ipv4,t.rowDetail.ipv4_ipv6=n.ipv4_ipv6,t.rowDetail.subme_ipv4=n.subme_ipv4&&"string"===typeof n.subme_ipv4?JSON.parse(n.subme_ipv4):[],t.rowDetail.subme_ipv6=n.subme_ipv6&&"string"===typeof n.subme_ipv6?JSON.parse(n.subme_ipv6):[],t.rowDetail.gatewayInfo=n.gatewayInfo),t.detailIsLoading=!1;case 6:case"end":return e.stop()}}),e)})))()},onUnitIpConfigOpen:function(){var t=this;return Object(r["a"])(Object(i["a"])().mark((function e(){var a,s;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(o["j"])();case 2:return a=e.sent,200==a.code&&(t.unitSelectArr=t.preprocessData(a.data)),e.next=6,Object(o["f"])({currentPage:1,pageSize:999});case 6:s=e.sent,200==s.code&&s.data&&(t.unitIpFormArr=s.data.obj);case 8:case"end":return e.stop()}}),e)})))()},preprocessData:function(t){function e(t){t.subAreas&&t.subAreas.length?t.subAreas.forEach((function(t){e(t)})):delete t.subAreas}return t.forEach((function(t){e(t)})),t},saveUnitIpBtn:function(){var t=this;return Object(r["a"])(Object(i["a"])().mark((function e(){var a,s;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(a=!0,s=0;s<t.unitIpFormArr.length;s++)t.$refs["formItem"+s][0].validate(function(){var t=Object(r["a"])(Object(i["a"])().mark((function t(e){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e||(a=!1);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());a&&t.saveFn();case 3:case"end":return e.stop()}}),e)})))()},saveFn:function(){var t=this;return Object(r["a"])(Object(i["a"])().mark((function e(){var a;return Object(i["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(o["i"])(t.unitIpFormArr);case 2:a=e.sent,200===a.code?(t.$message.success("保存成功"),t.onUnitIpConfigOpen()):t.$message.error(a.msg);case 4:case"end":return e.stop()}}),e)})))()},addUnitIpBtn:function(){this.unitIpFormArr.push({unitId:"",ipv4Subnet:"",ipv6Subnet:""})},delUnitIpBtn:function(t,e){var a=this;return Object(r["a"])(Object(i["a"])().mark((function s(){var n;return Object(i["a"])().wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(!t.id){s.next=7;break}return s.next=3,Object(o["a"])({ids:t.id});case 3:n=s.sent,200===n.code?(a.$message.success("删除成功"),a.onUnitIpConfigOpen()):a.$message.error(n.msg),s.next=8;break;case 7:a.unitIpFormArr.splice(e,1);case 8:case"end":return s.stop()}}),s)})))()}}},l=u,p=(a("c9d7"),a("2877")),d=Object(p["a"])(l,s,n,!1,null,"7919ae0c",null);e["default"]=d.exports},"6afb":function(t,e,a){},ae6f:function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));var s=a("b775");function n(t){return Object(s["a"])({url:"/admin/gather/log/list",method:"post",data:t})}},c9d7:function(t,e,a){"use strict";a("6afb")}}]);