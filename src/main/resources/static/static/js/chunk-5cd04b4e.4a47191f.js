(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5cd04b4e","chunk-4dbdde16"],{"24b4":function(e,t,n){"use strict";n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return a})),n.d(t,"f",(function(){return r})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return l}));var i=n("b775");function s(e){return Object(i["a"])({url:"/admin/gather/type",method:"get",params:e})}function a(e){return Object(i["a"])({url:"/admin/gather/main",method:"get",params:e})}function r(e){return Object(i["a"])({url:"/admin/gather/stop",method:"post",data:e})}function o(e){return Object(i["a"])({url:"/admin/sureying/log",method:"get",params:e})}function c(e){return Object(i["a"])({url:"/admin/sureying/log/single/segment",method:"get",params:e})}function l(e){return Object(i["a"])({url:"/admin/gather/log/status",method:"get",params:e})}},"3bb4":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-card",{scopedSlots:e._u([{key:"header",fn:function(){return[n("div",{staticClass:"clearfix"},[n("span",{staticStyle:{"line-height":"28px"}},[e._v("测绘日志")]),n("div",{staticClass:"fr"},[n("el-button",{attrs:{size:"small",type:"primary",disabled:e.isRunning},on:{click:e.handBtn}},[e.isRunning?n("span",[n("i",{staticClass:"el-icon-loading"}),e._v(" 测绘中...")]):n("span",[e._v("开始测绘")])]),n("el-button",{attrs:{size:"small",type:"warning",disabled:!e.isRunning},on:{click:e.stopBtn}},[n("span",[e._v("停止测绘")])]),n("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.noTestRow,expression:"!noTestRow"}],attrs:{size:"small",type:"success"},on:{click:function(t){e.viewDialogFlag=!0}}},[e._v("测绘结果")])],1)])]},proxy:!0}])},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.startLoading,expression:"startLoading"}],staticClass:"logWrap fz12"},[e._l(e.logList,(function(t){return[n("div",{key:t.id,staticClass:"logItem"},[n("div",{staticClass:"flexBox"},[n("div",{staticClass:"logContent"},[n("div",{staticClass:"logMsg"},[n("p",[e._v(e._s(t.name))]),n("div",{staticClass:"time"},[n("span",[e._v(e._s(t.beginTime))]),e._v(" ~ "),n("span",[n("span",{directives:[{name:"show",rawName:"v-show",value:1===t.status,expression:"item.status === 1"}],staticClass:"successC"},[n("i",{staticClass:"el-icon-loading"}),n("span",{staticClass:"fz12"},[e._v(e._s("数据上传"===t.name?"数据上传中...":"分析中..."))])]),e._v(" "+e._s(t.endTime)+" ")])])]),n("div",{directives:[{name:"show",rawName:"v-show",value:2===t.status,expression:"item.status === 2"}],staticClass:"dot green"},[e._v("成功")]),n("div",{directives:[{name:"show",rawName:"v-show",value:3===t.status,expression:"item.status === 3"}],staticClass:"dot red"},[e._v("失败")])]),n("div",{staticClass:"actions"})]),t.subLogs?n("div",{staticClass:"subLogWrap p-l-10"},e._l(t.subLogs,(function(i){return n("div",{key:i.id,staticClass:"subLogItem"},[n("p",{staticStyle:{color:"#7b7b7bbf","line-height":"1.5rem"}},[e._v(e._s(i.name))]),e._l(i.subLogDetails,(function(i){return n("div",{key:i.name,staticClass:"logContent p-l-10"},[n("div",{staticClass:"logMsg"},[n("p",[e._v(e._s(t.name))]),n("div",{staticClass:"time"},[n("span",[e._v(e._s(t.beginTime))]),e._v(" ~ "),n("span",[n("span",{directives:[{name:"show",rawName:"v-show",value:1===t.status,expression:"item.status === 1"}],staticClass:"successC"},[n("i",{staticClass:"el-icon-loading"}),n("span",{staticClass:"fz12"},[e._v(e._s("数据上传"===t.name?"数据上传中...":"分析中..."))])]),e._v(" "+e._s(t.endTime)+" ")])])]),n("div",{directives:[{name:"show",rawName:"v-show",value:2===t.status,expression:"item.status === 2"}],staticClass:"dot green"},[e._v("成功")]),n("div",{directives:[{name:"show",rawName:"v-show",value:3===t.status,expression:"item.status === 3"}],staticClass:"dot red"},[e._v("失败")])])}))],2)})),0):e._e()])]})),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.isRunning&&e.logList.length,expression:"!isRunning && logList.length"}],staticClass:"logItem flexBox"},[n("div",{staticClass:"logContent"},[n("div",{staticClass:"logMsg"},[n("p",[e._v("测绘完成")])])])])],2),n("el-dialog",{attrs:{"close-on-click-modal":!1,title:"测绘结果","custom-class":"mw600 smTank",visible:e.viewDialogFlag,width:"80%",top:"20%"},on:{"update:visible":function(t){e.viewDialogFlag=t},open:e.getAsyncList}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.detailIsLoading,expression:"detailIsLoading"}]},[n("fieldset",{staticClass:"m-b-10"},[n("legend",[e._v("终端统计")]),n("el-descriptions",{staticClass:"fz12",attrs:{column:1}},[n("el-descriptions-item",{attrs:{label:"IPv4终端"}},[e._v(e._s(e.rowDetail.ipv4))]),n("el-descriptions-item",{attrs:{label:"IPv4/IPv6终端"}},[e._v(e._s(e.rowDetail.ipv4_ipv6))])],1)],1)])])],1)},s=[],a=n("c7eb"),r=n("1da1"),o=(n("4de4"),n("d3b7"),n("24b4")),c=n("ae6f"),l={props:{configList:{type:Array,default:function(){return[]}}},data:function(){return{noTestRow:!1,viewTablePost:{currentPage:1,pageSize:15},isRunning:!1,startLoading:!1,logTimer:null,logList:[],viewDialogFlag:!1,defaultProps:{children:"subnetList",label:"ip"},detailIsLoading:!1,rowDetail:{result:"",ipv4:"",ipv4_ipv6:"",subme_ipv4:[],subme_ipv6:[],gatewayInfo:[]}}},watch:{configList:{handler:function(e){var t=this.configList.filter((function(e){return 1==e.deviceVendorSequence}));this.noTestRow=t.length>0,console.log(this.noTestRow)},deep:!0}},computed:{v4v6Ratio:function(){var e=this.rowDetail.ipv4,t=this.rowDetail.ipv4_ipv6;return e||t?e+t>=30?t/(e+t)>=.5:t/(e+t)>=.7:-1}},mounted:function(){this.getCaiJiStatus(),this.getAsyncList()},methods:{getCaiJiStatus:function(){var e=this;return Object(r["a"])(Object(a["a"])().mark((function t(){var n,i;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(o["e"])({type:1});case 2:if(n=t.sent,200!==n.code){t.next=10;break}if(1001!==n.data){t.next=10;break}return t.next=7,Object(o["a"])();case 7:i=t.sent,200==i.code&&i.data&&(e.logList=i.data.data),e.isRunning=!1;case 10:1002===n.code&&(e.isRunning=!0,e.getLogList());case 11:case"end":return t.stop()}}),t)})))()},stopBtn:function(){var e=this;return Object(r["a"])(Object(a["a"])().mark((function t(){var n;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(o["f"])();case 2:n=t.sent,200===n.code?(e.logTimer&&clearTimeout(e.logTimer),e.getCaiJiStatus(),e.$message.success("停止成功")):e.$message.error(n.msg);case 4:case"end":return t.stop()}}),t)})))()},handBtn:function(){var e=this;return Object(r["a"])(Object(a["a"])().mark((function t(){return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.isRunning){t.next=2;break}return t.abrupt("return",e.$message({message:"正在采集中... 请勿重复提交",type:"warning"}));case 2:Object(o["e"])(),setTimeout((function(){e.getCaiJiStatus()}),500);case 4:case"end":return t.stop()}}),t)})))()},getLogList:function(){var e=this;return Object(r["a"])(Object(a["a"])().mark((function t(){var n;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(o["a"])();case 2:if(n=t.sent,200!=n.code||!n.data){t.next=13;break}if(e.logList=n.data.data,!n.data.finish){t.next=10;break}return e.isRunning=!1,t.abrupt("return");case 10:e.isRunning=!0,e.logTimer&&clearTimeout(e.logTimer),e.logTimer=setTimeout((function(){e.getLogList()}),2e3);case 13:e.startLoading=!1;case 14:case"end":return t.stop()}}),t)})))()},getAsyncList:function(){var e=this;return Object(r["a"])(Object(a["a"])().mark((function t(){var n,i,s;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.detailIsLoading=!0,t.next=3,Object(c["a"])(e.viewTablePost);case 3:n=t.sent,200==n.code&&n.data&&(i=n.data.obj[0]||{},s=i.details&&"string"===typeof i.details?JSON.parse(i.details):{},e.rowDetail.result=i.result,e.rowDetail.ipv4=s.ipv4,e.rowDetail.ipv4_ipv6=s.ipv4_ipv6,e.rowDetail.subme_ipv4=s.subme_ipv4&&"string"===typeof s.subme_ipv4?JSON.parse(s.subme_ipv4):[],e.rowDetail.subme_ipv6=s.subme_ipv6&&"string"===typeof s.subme_ipv6?JSON.parse(s.subme_ipv6):[],e.rowDetail.gatewayInfo=s.gatewayInfo),e.detailIsLoading=!1;case 6:case"end":return t.stop()}}),t)})))()}}},d=l,u=(n("3d04"),n("2877")),p=Object(u["a"])(d,i,s,!1,null,"716cf07c",null);t["default"]=p.exports},"3d04":function(e,t,n){"use strict";n("78ab")},"703a":function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-card",{scopedSlots:e._u([{key:"header",fn:function(){return[n("div",{staticClass:"clearfix"},[n("span",{staticStyle:{"line-height":"28px"}},[e._v("采集设备配置")]),n("div",{staticClass:"fr"},[n("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.addBtn}},[e._v("新增")]),n("el-button",{attrs:{size:"small",type:"info"},on:{click:function(t){return e.$router.push({path:"/"})}}},[e._v("返回首页")])],1)])]},proxy:!0}])},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticClass:"fromWrap"},[n("el-empty",{directives:[{name:"show",rawName:"v-show",value:!e.formArr.length,expression:"!formArr.length"}],attrs:{description:"暂无数据..."}}),e._l(e.formArr,(function(t,i){return n("el-form",{key:i,ref:"formItem"+i,refInFor:!0,staticClass:"formItemEle m-b-10 p-b-10 p-l-10 p-r-10",attrs:{model:t,rules:e.rules,"label-position":"top",size:"mini"}},[n("div",{staticClass:"flex between wrap",staticStyle:{"align-items":"self-end"}},[n("el-col",{staticClass:"inputWrap",attrs:{md:18,lg:20}},[n("el-form-item",{attrs:{label:i+1+"# 设备名称",prop:"name"}},[n("el-input",{model:{value:t.name,callback:function(n){e.$set(t,"name","string"===typeof n?n.trim():n)},expression:"formItem.name"}})],1),n("el-form-item",{staticStyle:{width:"160px"},attrs:{label:"设备类型/品牌",prop:"deviceTypeVendorArr"}},[n("el-cascader",{attrs:{options:e.deviceTypeVendorSelectArr,props:{expandTrigger:"hover",children:"deviceVendorList",label:"name",value:"id"}},on:{change:function(n){return e.handleChangeTypeVendor(i,t)}},model:{value:t.deviceTypeVendorArr,callback:function(n){e.$set(t,"deviceTypeVendorArr",n)},expression:"formItem.deviceTypeVendorArr"}})],1),n("el-form-item",{attrs:{label:"管理IP",prop:"ip"}},[n("el-input",{model:{value:t.ip,callback:function(n){e.$set(t,"ip","string"===typeof n?n.trim():n)},expression:"formItem.ip"}})],1),n("el-form-item",{attrs:{label:"登陆方式",prop:"loginType"}},[n("el-select",{on:{change:function(n){return e.loginTypeChange(t)}},model:{value:t.loginType,callback:function(n){e.$set(t,"loginType","string"===typeof n?n.trim():n)},expression:"formItem.loginType"}},[n("el-option",{attrs:{value:"ssh"}},[e._v("ssh")]),n("el-option",{attrs:{value:"telnet"}},[e._v("telnet")]),n("el-option",{attrs:{value:"api"}},[e._v("api")])],1)],1),n("el-form-item",{attrs:{label:"端口"}},[n("el-input",{attrs:{placeholder:"ssh"===t.loginType?"22":"23"},model:{value:t.loginPort,callback:function(n){e.$set(t,"loginPort","string"===typeof n?n.trim():n)},expression:"formItem.loginPort"}})],1),n("el-form-item",{attrs:{label:"用户名",prop:"loginName"}},[n("el-input",{attrs:{autocomplete:"new-login"},model:{value:t.loginName,callback:function(n){e.$set(t,"loginName","string"===typeof n?n.trim():n)},expression:"formItem.loginName"}})],1),n("el-form-item",{attrs:{label:"密码",prop:"loginPassword"}},[n("el-input",{attrs:{type:"password",autocomplete:"new-password"},model:{value:t.loginPassword,callback:function(n){e.$set(t,"loginPassword","string"===typeof n?n.trim():n)},expression:"formItem.loginPassword"}})],1),"派网"==t.deviceVendorName?n("el-form-item",{staticStyle:{width:"150px"},attrs:{label:"双栈模式"}},[n("el-select",{attrs:{placeholder:"请选择"},model:{value:t.state,callback:function(n){e.$set(t,"state",n)},expression:"formItem.state"}},[n("el-option",{attrs:{label:"IPv4网关在派网",value:!0}}),n("el-option",{attrs:{label:"IPv4网关不在派网",value:!1}})],1)],1):e._e()],1),n("div",[n("p",{staticClass:"textTips fz14",staticStyle:{"margin-bottom":"4px"}},[1===t.testFlag?n("span",{staticClass:"successC"},[e._v("登录正常")]):e._e(),0===t.testFlag?n("span",{staticClass:"dangerC"},[e._v("登录失败")]):e._e()]),n("div",[n("el-button",{directives:[{name:"show",rawName:"v-show",value:0==t.deviceVendorSequence,expression:"formItem.deviceVendorSequence == 0"}],attrs:{plain:"",size:"mini",type:"primary",disabled:t.testLoading},on:{click:function(n){return e.testBtn(t,i)}}},[n("i",{directives:[{name:"show",rawName:"v-show",value:t.testLoading,expression:"formItem.testLoading"}],staticClass:"el-icon-loading"}),e._v(" 测试")]),n("el-button",{attrs:{plain:"",size:"mini",type:"danger"},on:{click:function(n){return e.delRow(t,i)}}},[e._v("删除")])],1)])],1)])}))],2),n("div",{directives:[{name:"show",rawName:"v-show",value:e.formArr.length,expression:"formArr.length"}],staticClass:"flexCC"},[n("el-button",{attrs:{type:"success"},on:{click:e.saveBtn}},[e._v("保存配置")])],1)]),n("hand",{staticClass:"m-t-10",attrs:{configList:e.formArr}})],1)},s=[],a=n("c7eb"),r=n("1da1"),o=n("3835"),c=(n("7db0"),n("d3b7"),n("b0c0"),n("d81d"),n("e9c4"),n("159b"),n("a9e3"),n("a434"),n("da71")),l=n("3bb4"),d={components:{hand:l["default"]},data:function(){return{isLoading:!1,formArr:[{name:"",deviceTypeVendorArr:[],deviceTypeId:"",deviceVendorId:"",deviceVendorSequence:"",deviceModelId:"",ip:"",loginType:"ssh",loginPort:"",loginName:"",loginPassword:"",testLoading:!1,testFlag:null,state:null}],rules:{name:[{required:!0,message:"请输入设备名称",trigger:"blur"}],deviceTypeVendorArr:[{required:!0,message:"请输入设备类型、品牌",trigger:"blur"}],deviceVendorId:[{required:!0,message:"请输入品牌",trigger:"blur"}],ip:[{required:!0,message:"请输入管理IP",trigger:"blur"}],loginType:[{required:!0,message:"请选择登陆方式",trigger:"blur"}],loginName:[{required:!0,message:"请输入用户名",trigger:"blur"}],loginPassword:[{required:!0,message:"请输入密码",trigger:"blur"}]},deviceTypeVendorSelectArr:[],deviceVendorArr:[]}},created:function(){this.getList()},methods:{addBtn:function(){this.formArr.push({id:"",name:"",deviceTypeVendorArr:[],deviceTypeId:"",deviceVendorId:"",deviceVendorSequence:"",deviceModelId:"",ip:"",loginType:"ssh",loginPort:"",loginName:"",loginPassword:"",testLoading:!1,testFlag:null,state:null})},handleChangeTypeVendor:function(e,t){console.log(t.deviceTypeVendorArr);var n=Object(o["a"])(t.deviceTypeVendorArr,2),i=n[0],s=n[1];if(i&&s){this.formArr[e].deviceTypeId=i||"",this.formArr[e].deviceVendorId=s||"";var a=this.deviceTypeVendorSelectArr.find((function(e){return e.id==i})),r=a&&a.deviceVendorList.find((function(e){return e.id==s}));this.formArr[e].deviceVendorSequence=r.sequence,this.formArr[e].deviceVendorName=r.name,"派网"==r.name&&(this.formArr[e].state=!0)}},getList:function(){var e=this;return Object(r["a"])(Object(a["a"])().mark((function t(){var n,i,s,r;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isLoading=!0,t.next=3,Object(c["d"])({currentPage:1,pageSize:999});case 3:n=t.sent,200===n.code&&n.data&&(i=n.data,s=i.obj,r=i.other,e.formArr=s.map((function(e){return e.deviceTypeVendorArr=[e.deviceTypeId,e.deviceVendorId],e.testLoading=!1,e.testFlag=null,e})),r&&(e.deviceTypeVendorSelectArr=r.deviceType,e.deviceVendorArr=r.deviceVendor)),e.isLoading=!1;case 6:case"end":return t.stop()}}),t)})))()},loginTypeChange:function(e){var t="";"ssh"===e.loginType?t="22":"telnet"===e.loginType?t="23":"api"===e.loginType&&(t="443"),e.loginPort=t},saveBtn:function(){for(var e=!0,t=0;t<this.formArr.length;t++){var n=this.formArr[t];delete n.createTime,this.$refs["formItem"+t][0].validate(function(){var t=Object(r["a"])(Object(a["a"])().mark((function t(n){return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:n||(e=!1);case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}e&&this.saveFn()},saveFn:function(){var e=this;return Object(r["a"])(Object(a["a"])().mark((function t(){var n,i;return Object(a["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=JSON.parse(JSON.stringify(e.formArr)),n.forEach((function(e){e.loginPort||(e.loginPort="ssh"===e.loginType?"22":"23"),delete e.deviceTypeVendorArr,delete e.testLoading,delete e.testFlag,delete e.deviceVendorSequence})),t.next=4,Object(c["e"])(n);case 4:i=t.sent,200===i.code?(e.$message.success("保存成功"),e.getList()):e.$message.error(i.msg);case 6:case"end":return t.stop()}}),t)})))()},testBtn:function(e,t){var n=this;return Object(r["a"])(Object(a["a"])().mark((function i(){var s;return Object(a["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(e.id){i.next=2;break}return i.abrupt("return",n.$message.error("请先保存"));case 2:return e.testLoading=!0,n.formArr[t].testFlag=null,i.next=6,Object(c["g"])({id:e.id});case 6:s=i.sent,200===s.code?n.formArr[t].testFlag=Number(s.data):n.$message.error(s.msg),e.testLoading=!1;case 9:case"end":return i.stop()}}),i)})))()},delRow:function(e,t){var n=this;return Object(r["a"])(Object(a["a"])().mark((function i(){var s;return Object(a["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(!e.id){i.next=7;break}return i.next=3,Object(c["a"])({ids:e.id});case 3:s=i.sent,200===s.code?(n.$message.success("删除成功"),n.getList()):n.$message.error(s.msg),i.next=8;break;case 7:n.formArr.splice(t,1);case 8:case"end":return i.stop()}}),i)})))()}}},u=d,p=(n("ed94"),n("2877")),m=Object(p["a"])(u,i,s,!1,null,"118ac232",null);t["default"]=m.exports},"78ab":function(e,t,n){},"7db0":function(e,t,n){"use strict";var i=n("23e7"),s=n("b727").find,a=n("44d2"),r=n("ae40"),o="find",c=!0,l=r(o);o in[]&&Array(1)[o]((function(){c=!1})),i({target:"Array",proto:!0,forced:c||!l},{find:function(e){return s(this,e,arguments.length>1?arguments[1]:void 0)}}),a(o)},a3d1:function(e,t,n){},ae6f:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n("b775");function s(e){return Object(i["a"])({url:"/admin/gather/log/list",method:"post",data:e})}},da71:function(e,t,n){"use strict";n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return a})),n.d(t,"g",(function(){return r})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return c})),n.d(t,"f",(function(){return l})),n.d(t,"b",(function(){return d}));var i=n("b775");function s(e){return Object(i["a"])({url:"/admin/device/list",method:"post",data:e})}function a(e){return Object(i["a"])({url:"/admin/device/batch/save",method:"post",data:e})}function r(e){return Object(i["a"])({url:"/admin/device/test",method:"get",params:e})}function o(e){return Object(i["a"])({url:"/admin/device/delete",method:"DELETE",params:e})}function c(e){return Object(i["a"])({url:"/admin/single/segment",method:"get",params:e})}function l(e){return Object(i["a"])({url:"/admin/single/segment",method:"post",data:e})}function d(e){return Object(i["a"])({url:"/admin/single/segment",method:"DELETE",params:e})}},ed94:function(e,t,n){"use strict";n("a3d1")}}]);