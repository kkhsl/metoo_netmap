(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3e2dce77"],{"37f9":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"grid",staticStyle:{position:"relative"}},[n("el-col",{staticClass:"gridItem",attrs:{sm:12,md:8,lg:6}},[n("div",{staticClass:"card flexCC",on:{click:function(t){return e.jump("/surveying")}}},[n("h3",{staticClass:"title"},[e._v("网络测绘")])])]),n("el-col",{staticClass:"gridItem",attrs:{sm:12,md:8,lg:6}},[n("div",{staticClass:"card flexCC",on:{click:function(t){return e.jump("/empower")}}},[n("h3",{staticClass:"title"},[e._v(e._s(e.authorized?"授权信息":"未授权"))]),n("div",{directives:[{name:"show",rawName:"v-show",value:e.authorized,expression:"authorized"}],staticClass:"descWrap"},[n("p",{staticClass:"desc"},[e._v("版本:"+e._s(e.licenseInfo.licenseVersion))]),n("p",{staticClass:"desc"},[e._v(" 当前授权: "),n("span",{directives:[{name:"show",rawName:"v-show",value:e.licenseInfo.city,expression:"licenseInfo.city"}]},[e._v(e._s(e.licenseInfo.city))]),n("span",{directives:[{name:"show",rawName:"v-show",value:e.licenseInfo.area,expression:"licenseInfo.area"}]},[e._v(e._s(e.licenseInfo.area))]),e._v(" "+e._s(e.licenseInfo.unit)+" ")]),n("p",{staticClass:"desc"},[e._v("到期时间:"+e._s(e.parseTime(e.licenseInfo.endTime)))])])])]),n("el-col",{directives:[{name:"show",rawName:"v-show",value:e.compareVersions<0,expression:"compareVersions < 0"}],staticClass:"gridItem",attrs:{sm:12,md:8,lg:6}},[n("div",{staticClass:"card flexCC",on:{click:e.startUpdateFn}},[n("h3",{staticClass:"title"},[e._v("版本升级")]),n("div",{staticClass:"descWrap"},[n("p",{staticClass:"desc"},[e._v("发现新版本("+e._s(e.version.version)+")")]),n("p",{staticClass:"desc"},[e._v("立即升级")])])])])],1)},s=[],r=n("c7eb"),i=n("1da1"),c=(n("d81d"),n("a9e3"),n("cbcf")),o=n("b775");function u(e){return Object(o["a"])({url:"/admin/application/version",method:"get",params:e})}function d(e){return Object(o["a"])({url:"/admin/application/version/maual/update",method:"get",params:e})}function l(e){return Object(o["a"])({url:"/admin/application/version/update/state",method:"get",params:e})}var p=n("ed08"),m=n("84d3"),f=n.n(m),v={name:"INDEX",data:function(){return{version:{currentVersion:"0.0.0.0",version:"0.0.0.0"},updateLoading:null,authorized:!1,licenseInfo:{}}},mounted:function(){var e=this;return Object(i["a"])(Object(r["a"])().mark((function t(){return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.getUpdateState(),new f.a(e.$refs.grid,{itemSelector:".gridItem"});case 2:case"end":return t.stop()}}),t)})))()},activated:function(){this.getLicenseInfo(),this.getVersionInfo()},computed:{compareVersions:function(){var e=this.version.currentVersion.split(".").map(Number),t=this.version.version.split(".").map(Number),n=Math.max(e.length,t.length);while(e.length<n)e.push(0);while(t.length<n)t.push(0);for(var a=0;a<n;a++){if(e[a]>t[a])return 1;if(e[a]<t[a])return-1}return 0}},methods:{parseTime:p["b"],getLicenseInfo:function(){var e=this;return Object(i["a"])(Object(r["a"])().mark((function t(){var n;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(c["c"])();case 2:n=t.sent,200==n.code?(e.licenseInfo=n.data,e.authorized=!0):(e.licenseInfo={},e.authorized=!1);case 4:case"end":return t.stop()}}),t)})))()},getVersionInfo:function(){var e=this;return Object(i["a"])(Object(r["a"])().mark((function t(){var n,a,s,i,c;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,u();case 2:n=t.sent,200==n.code&&(a=n.data,s=a.currentVersion,i=void 0===s?"0.0.0.0":s,c=a.version,e.version={currentVersion:i,version:c});case 4:case"end":return t.stop()}}),t)})))()},getUpdateState:function(){var e=this;return Object(i["a"])(Object(r["a"])().mark((function t(){var n;return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,l();case 2:n=t.sent,200==n.code&&n.data&&(n.data.state>0&&n.data.state<4?(e.updateLoading||(e.updateLoading=e.$loading({lock:!0,text:"正在升级中...请勿刷新页面",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.6)"})),setTimeout(e.getUpdateState,3e3)):(e.updateLoading&&e.updateLoading.close(),e.updateLoading=null));case 4:case"end":return t.stop()}}),t)})))()},startUpdateFn:function(){var e=this;return Object(i["a"])(Object(r["a"])().mark((function t(){return Object(r["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:setTimeout(e.getUpdateState,1e3),d().then((function(t){setTimeout((function(){e.updateLoading&&e.updateLoading.close(),200==t.code?e.$message.success(t.msg):e.$message.error(t.msg),setTimeout((function(){location.reload()}),3e3)}),3e4)}));case 2:case"end":return t.stop()}}),t)})))()},jump:function(e,t){this.$router.push({path:e,query:t})}}},h=v,g=(n("9e6c"),n("2877")),b=Object(g["a"])(h,a,s,!1,null,"e60c209e",null);t["default"]=b.exports},5527:function(e,t,n){},"9e6c":function(e,t,n){"use strict";n("5527")},cbcf:function(e,t,n){"use strict";n.d(t,"e",(function(){return s})),n.d(t,"d",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return o}));var a=n("b775");function s(){return Object(a["a"])({url:"/admin/area/all",method:"get"})}function r(){return Object(a["a"])({url:"/admin/license/systemInfo",method:"get"})}function i(){return Object(a["a"])({url:"/admin/license/query",method:"get"})}function c(e){return Object(a["a"])({url:"/admin/license/update",method:"put",data:e})}function o(e){return Object(a["a"])({url:"/admin/license/applicant/code",method:"post",data:e})}}}]);